
{% extends "base.html" %}
{% load i18n %}

{% block title %}
    {% trans "Latest News" %}
{% endblock %}

{% block content %}

<div class="columns-row">

    <!-- Linke Seite: Filter -->

    <!-- Button für Filter auf Mobilgeräten -->
    <button type="button" class="fixed right-0 top-1/2 md:hidden" data-dropdown-toggle="filter-dropdown" id="filter-button">
        <svg xmlns="http://www.w3.org/2000/svg" fill="white" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-10">
            <path stroke-linecap="round" stroke-linejoin="round" d="M12 3c2.755 0 5.455.232 8.083.678.533.09.917.556.917 1.096v1.044a2.25 2.25 0 0 1-.659 1.591l-5.432 5.432a2.25 2.25 0 0 0-.659 1.591v2.927a2.25 2.25 0 0 1-1.244 2.013L9.75 21v-6.568a2.25 2.25 0 0 0-.659-1.591L3.659 7.409A2.25 2.25 0 0 1 3 5.818V4.774c0-.54.384-1.006.917-1.096A48.32 48.32 0 0 1 12 3Z" />
        </svg>
    </button>

    <div id="filter" class="side-column scrollable-column">
        <form id="news-filter-form" method="get" class="overflow-y-auto">
            <h2 class="text-xl font-bold my-4 text-gray-800 dark:text-gray-100">{% trans "Filter" %}</h2>
            <div>
                <!-- Standort Button -->
                <button type="button" class="w-full text-left md:text-lg font-semibold py-2 focus:outline-none flex items-center hover:bg-gray-200 dark:hover:bg-gray-800 dark:text-white rounded transition cursor-pointer" onclick="toggleFilter('standorte')">
                    <span id="chevron-standorte" class="inline-block transition-transform duration-200 mr-2">&gt;</span>
                    {% trans "Standorte" %}
                </button>
                <!-- Standorte -->
                <div id="filter-standorte" class="hidden ml-2">
                    {% for loc in locations %}
                    <label class="block text-gray-800 dark:text-white hover:bg-gray-200 dark:hover:bg-gray-800 rounded px-1">
                        <input type="checkbox" name="location" value="{{ loc.identifier }}" class="mr-2"
                        {% if loc.identifier in active_filters.locations %}checked{% endif %}>
                        {{ loc.emoji }} {{ loc.name }}
                    </label>
                    {% endfor %}
                </div>
            </div>
            <div>
                <!-- Kategorien Button -->
                <button type="button" class="w-full text-left md:text-lg font-semibold py-2 focus:outline-none flex items-center hover:bg-gray-200 dark:hover:bg-gray-800 dark:text-white rounded transition cursor-pointer" onclick="toggleFilter('kategorien')">
                    <span id="chevron-kategorien" class="inline-block transition-transform duration-200 mr-2">&gt;</span>
                    {% trans "Kategorien" %}
                </button>
                <!-- Kategorien -->
                <div id="filter-kategorien" class="hidden ml-2">
                    {% for cat in categories %}
                    <label class="block text-gray-800 dark:text-white hover:bg-gray-200 dark:hover:bg-gray-800 rounded px-1">
                        <input type="checkbox" name="category" value="{{ cat.identifier }}" class="mr-2"
                        {% if cat.identifier in active_filters.categories %}checked{% endif %}>
                        {{ cat.emoji }} {{ cat.name }}
                    </label>
                    {% endfor %}
                </div>
            </div>
            <div>
                <!-- Zielgruppen Button -->
                <button type="button" class="w-full text-left md:text-lg font-semibold py-2 focus:outline-none flex items-center hover:bg-gray-200 dark:hover:bg-gray-800 dark:text-white rounded transition cursor-pointer" onclick="toggleFilter('zielgruppen')">
                    <span id="chevron-zielgruppen" class="inline-block transition-transform duration-200 mr-2">&gt;</span>
                    {% trans "Zielgruppen" %}
                </button>
                <!-- Zielgruppen -->
                <div id="filter-zielgruppen" class="hidden ml-2">
                    {% for aud in audiences %}
                    <label class="block text-gray-800 dark:text-white hover:bg-gray-200 dark:hover:bg-gray-800 rounded px-1">
                        <input type="checkbox" name="audience" value="{{ aud.identifier }}" class="mr-2"
                        {% if aud.identifier in active_filters.audiences %}checked{% endif %}>
                        {{ aud.emoji }} {{ aud.name }}
                    </label>
                    {% endfor %}
                </div>
            </div>
            <div>
                <!-- Quellen Button -->
                <button type="button" class="w-full text-left md:text-lg font-semibold py-2 focus:outline-none flex items-center hover:bg-gray-200 dark:hover:bg-gray-800 dark:text-white rounded transition cursor-pointer" onclick="toggleFilter('quellen')">
                    <span id="chevron-quellen" class="inline-block transition-transform duration-200 mr-2">&gt;</span>
                    {% trans "Quellen" %}
                </button>
                <!-- Quellen -->
                <div id="filter-quellen" class="hidden ml-2">
                    {% for src in sources %}
                    <label class="block text-gray-800 dark:text-white hover:bg-gray-200 dark:hover:bg-gray-800 rounded px-1">
                        <input type="checkbox" name="source" value="{{ src.identifier }}" class="mr-2"
                        {% if src.identifier in active_filters.sources %}checked{% endif %}>
                        {{ src.emoji }} {{ src.name }}
                    </label>
                    {% endfor %}
                </div>
            </div>
            <!-- Allgemeine Buttons -->
            <button type="button" id="select-all-btn" class="bg-gray-200 dark:bg-gray-800 dark:text-gray-100 rounded-md px-2 py-1 text-sm hover:bg-gray-300 dark:hover:bg-gray-700 mr-1 my-3 cursor-pointer">{% trans "Alles auswählen" %}</button>
            <button type="button" id="reset-filter-btn" class="bg-gray-200 dark:bg-gray-800 dark:text-gray-100 rounded-md px-2 py-1 text-sm hover:bg-gray-300 dark:hover:bg-gray-700 my-3 cursor-pointer">{% trans "Alles abwählen" %}</button>
            <button type="button" id="apply-filter-btn" class="bg-[#042c58] dark:bg-gray-800 text-white dark:text-gray-100 rounded-md px-4 py-2 hover:bg-[#064694] dark:hover:bg-gray-700 mb-6 cursor-pointer">{% trans "Filter anwenden" %}</button>
        </form>
    </div>

    <!-- Mitte: News -->

    <div id="news" class="middle-column scrollable-column">
        <div id="news-container" class="news-container">
            {% if detail_news %}
            {% include "news/partials/_news_detail.html" with news=detail_news %}
            {% else %}
            {% include "news/partials/_news_list.html" with news_list=news_list has_more=has_more %}
            {% endif %}
        </div>
    </div>

    <!-- Rechte Seite: Terminkalender -->

    <div id="calendar" class="side-column">
        <h2 class="text-xl font-bold my-4 text-gray-800 dark:text-gray-100">{% trans "Nächste Termine" %}</h2>
        {% if upcoming_events %}
        <a href="{% url 'calendar_page' %}">
            <ul class="space-y-4">
                {% for event in upcoming_events %}
                <li class="bg-gray-50 dark:bg-gray-800 p-4 mr rounded-lg shadow">
                    <p class="font-bold text-gray-800 dark:text-gray-100">{{ event.title }}</p>
                    <p class="text-sm text-gray-500 dark:text-gray-400">{{ event.start|date:"d.m.Y H:i" }} - {{ event.end|date:"H:i" }}</p>
                </li>
                {% endfor %}
            </ul>
        </a>
        {% else %}
        <p class="text-gray-500 dark:text-gray-400 italic text-center">{% trans "Keine anstehenden Termine." %}</p>
        {% endif %}
    </div>
</div>

<script src="{% static 'js/newsFeedCore.js' %}"></script>
<script src="{% static 'js/news.js' %}"></script>
{% endblock %}
